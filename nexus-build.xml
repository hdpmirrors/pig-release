  <project name="nexus-deploy" default="stage" basedir="." 
  xmlns:artifact="urn:maven-artifact-ant">
    <import file="build.xml" as="apache"/>
    
      <macrodef name="nexus-plugin" description="macro definition for publishing artifacts to nexus">
        <attribute name="maven-jar"/>
        <attribute name="pomname"/>
        <attribute name="attachas" default=""/>
        <sequential>
          <artifact:mvn>
            <arg value="org.apache.maven.plugins:maven-gpg-plugin:1.4:sign-and-deploy-file" />
            <arg value="-Durl=${asfstagingrepo}"/>
            <arg value="-DrepositoryId=${staging_repo_id}"/>
            <arg value="-Dfile=@{maven-jar}"/>
            <arg value="-Dpackaging=jar"/>
            <arg value="-DpomFile=@{pomname}"/>
            <arg value="-Dclassifier=@{attachas}"/>
            <arg value="-Dtype=jar"/>
            <arg value="-Pgpg"/>
          </artifact:mvn>
        </sequential>
      </macrodef>

      <target name="stage" depends="apache.mvn-build, apache.jar, apache.mvn-taskdef, apache.set-version" description="deploy artifact to a nexus repository">
      <nexus-plugin maven-jar="${output.jarfile.core}" pomname="${pig.pom}"/>
      <nexus-plugin maven-jar="${output.jarfile.sources}" pomname="${pig.pom}" attachas="sources"/>
      <nexus-plugin maven-jar="${output.jarfile.javadoc}" pomname="${pig.pom}" attachas="javadoc"/>
      <nexus-plugin maven-jar="${pigunit.jarfile}" pomname="${pigunit.pom}"/>
      <nexus-plugin maven-jar="${smoke.tests.jarfile}" pomname="${pigsmoke.pom}"/>
      <nexus-plugin maven-jar="${output.jarfile.core-h2}" pomname="${pig.pom}" attachas="h2"/>
    </target>
  </project>
